{{ $outDir := printf "/out/%08d" .infoRes.Info.Ts }}
{{ $time := .infoRes.Info.Ts | RFC1123 }}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Citrus Test Result</title>
    <link href="/static/style.css" rel="stylesheet" media="all">
  </head>
<html>
<body>

  <div class="center">
    <h1>Citrus Test Result</h1>
  </div>

  <h3>Snapshot from {{ $time }}</h3>
  <table>
    <thread>
    <tr>
      <th>Repository</th>
      <th>Branch</th>
      <th>Commit</th>
    </tr>
    </thread>
    <tbody>
    {{ range $index, $infoRepo := .infoRes.Info.Repos }}
    <tr>
      <td><a href="{{ $infoRepo.URL }}">{{ $infoRepo.URL | RepoName }}</a></td>
      <td>{{ $infoRepo.Branch }}</td>
      <td><pre>{{ $infoRepo.CommitHash }}</pre></td>
    </tr>
    {{ end }}
    </tbody>
  </table>

  {{ with .infoRes.Res }}
    <h2><div class="res {{ .Result }}">{{ .Result | Res2Icon }}</div> Scripts Results</h2>

    <h3>Setup</h3>

    <ul>
      {{ with .Setup.Result }}
        <li>
          <div class="res {{ . }}">{{ . | Res2Icon }}</div>
          <a href="{{ $outDir }}/setup.out.txt">
            <strong>global</strong>
          </a>
        </li>
      {{ end }}
      {{ range $name, $result := .Setup.Repos }}
      <li>
        <div class="res {{ $result }}">{{ $result | Res2Icon }}</div>
        <a href="{{ $outDir }}/{{ $name }}/setup.out.txt">
          <strong>{{ $name }}</strong>
        </a>
      </li>
      {{ end }}
    </ul>

    <h3>Start</h3>

    <ul>
      {{ range $name, $scripts := .Start.Repos }}
      <li> <strong>{{ $name }}</strong>
          <ul>
            {{ range $script, $result := $scripts }}
            <li>
              <div class="res {{ $result }}">{{ $result | Res2Icon }}</div>
              <a href="{{ $outDir }}/{{ $script }}.out.txt">
                <strong>{{ $script }}</strong>
              </a>
            </li>
            {{ end }}
          </ul>
      </li>
      {{ end }}
    </ul>

    <h3>Test</h3>

    <ul>
      {{ range $name, $scripts := .Test.Repos }}
      <li> <strong>{{ $name }}</strong>
          <ul>
            {{ range $script, $result := $scripts }}
            <li>
              <div class="res {{ $result }}">{{ $result | Res2Icon }}</div>
              <a href="{{ $outDir }}/{{ $script }}.out.txt">
                <strong>{{ $script }}</strong>
              </a>
            </li>
            {{ end }}
          </ul>
      </li>
      {{ end }}
    </ul>

    <h3>Stop</h3>

    <ul>
    {{ with .Stop.Result }}
      <li>
        <div class="res {{ . }}">{{ . | Res2Icon }}</div>
        <a href="{{ $outDir }}/stop.out.txt">
          <strong>global</strong>
        </a>
      </li>
    {{ end }}
      {{ range $name, $result := .Stop.Repos }}
      <li>
        <div class="res {{ $result }}">{{ $result | Res2Icon }}</div>
        <a href="{{ $outDir }}/{{ $name }}/stop.out.txt">
          <strong>{{ $name }}</strong>
        </a>
      </li>
      {{ end }}
    </ul>
  {{ else }}
    <h2>Scripts Results</h2>
    Running...
  {{ end }}

</body>
</html>

